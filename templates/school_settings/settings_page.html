{% extends "../base.html" %}
{% load crispy_forms_tags %}

{% block page_title %}School Settings{% endblock page_title %}
{% block content %}
    <div class="clearfix"></div>

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb bg-light rounded-pill px-3 py-2">
            <li class="breadcrumb-item"><a href="{% url 'dashboard' %}"><i class="fa fa-home"></i> Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">School Settings</li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1"><i class="fa fa-cogs text-primary"></i> School Settings</h2>
                    <p class="text-muted mb-0">Manage school configuration, sections, signatures, and departments</p>
                </div>
                <div class="text-right">
                    <small class="text-muted">Last updated: {{ school_settings.updated_at|default:"Never" }}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Card with Enhanced Tabs -->
    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <ul class="nav nav-tabs card-header-tabs border-0" id="settingsTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="general-tab" data-toggle="tab" href="#general" role="tab" aria-controls="general" aria-selected="true">
                        <i class="fa fa-cog"></i> General
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="sections-tab" data-toggle="tab" href="#sections" role="tab" aria-controls="sections" aria-selected="false">
                        <i class="fa fa-layer-group"></i> Sections
                        {% if school_sections %}
                            <span class="badge badge-secondary">{{ school_sections|length }}</span>
                        {% endif %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="signatures-tab" data-toggle="tab" href="#signatures" role="tab" aria-controls="signatures" aria-selected="false">
                        <i class="fa fa-signature"></i> Signatures
                        {% if signatures %}
                            <span class="badge badge-secondary">{{ signatures|length }}</span>
                        {% endif %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="departments-tab" data-toggle="tab" href="#departments" role="tab" aria-controls="departments" aria-selected="false">
                        <i class="fa fa-sitemap"></i> Departments
                        {% if departments %}
                            <span class="badge badge-secondary">{{ departments|length }}</span>
                        {% endif %}
                    </a>
                </li>
            </ul>
        </div>
        <div class="card-body p-0">
            <div class="tab-content" id="settingsTabsContent">
                <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                    <div class="p-4">
                        {% include "./school_details.html" %}
                    </div>
                </div>
                <div class="tab-pane fade" id="sections" role="tabpanel" aria-labelledby="sections-tab">
                    {% include "./sections.html" %}
                </div>
                <div class="tab-pane fade" id="signatures" role="tabpanel" aria-labelledby="signatures-tab">
                    {% include "./signatures.html" %}
                </div>
                <div class="tab-pane fade" id="departments" role="tabpanel" aria-labelledby="departments-tab">
                    {% include "./departments.html" %}
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Tab Navigation Script -->
    <script>
    (function() {
        // Activate tab from URL hash if present
        var hash = window.location.hash;
        if (hash) {
            var target = document.querySelector('a[href="' + hash + '"]');
            if (target) {
                $(target).tab('show');
            }
        }

        // Update hash when tab changes
        $('#settingsTabs a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var newHash = e.target.getAttribute('href');
            if (newHash) {
                history.replaceState(null, null, newHash);
            }
        });

        // Add smooth transitions
        $('#settingsTabs a[data-toggle="tab"]').on('show.bs.tab', function (e) {
            $('.tab-pane').removeClass('show');
        });

        $('#settingsTabs a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $('.tab-pane.active').addClass('show');
        });
    })();
    </script>



{% endblock content%}
