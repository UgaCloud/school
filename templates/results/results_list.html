{% extends 'base.html' %}
{% load custom_filters %}

{% block content %}
<div class="container mt-4">
    <h2>Student Results</h2>

    <!-- Filter Form -->
    <form method="get" class="form-inline mb-4" id="filter-form">
        ...
    </form>

    <script>
        function submitForm() {
            document.getElementById('filter-form').submit();
        }
    </script>

    <!-- Display Student Results -->
    {% if student_results %}
        {% for student, subjects in student_results.items %}
        <div class="student-section mb-5">
            <h4><strong>{{ student }}</strong></h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Subject</th>
                        {% for atype in assessment_types %}
                            <th>{{ atype }}</th>
                        {% endfor %}
                        <th>Final Score</th>
                        <th>Grade</th>
                        <th>Points</th>
                    </tr>
                </thead>
                <tbody>
                    {% for subject, data in subjects.items %}
                        {% if subject != 'total_final_score' and subject != 'total_points' and subject != 'student_id' %}
                        <tr>
                            <td>{{ subject }}</td>
                            {% for atype in assessment_types %}
                                <td>{{ data|get_item:atype|default:"-" }}</td>
                            {% endfor %}
                            <td>{{ data.final_score }}</td>
                            <td>{{ data.grade }}</td>
                            <td>{{ data.points }}</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                    <tr>
                        <td colspan="{{ assessment_types|length|add:1 }}" class="text-right font-weight-bold">Total</td>
                        <td>{{ subjects.total_final_score }}</td>
                        <td></td>
                        <td>{{ subjects.total_points }}</td>
                    </tr>
                </tbody>
            </table>

            <div class="text-right mt-2">
                <a href="{% url 'report_card' student_id=subjects.student_id %}" class="btn btn-primary">
                    View Report Card
                </a>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-warning" role="alert">
            No results available 
        </div>
    {% endif %}
</div>
{% endblock %}
