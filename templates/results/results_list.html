{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>Student Results</h2>

    <!-- Filter Form -->
    <form method="get" class="form-inline mb-4">
        <label for="class_id" class="mr-2">Select Class:</label>
        <select name="Class_id" id="class_id" class="form-control mr-2">
            <option value="">All Classes</option>
            {% for cls in classes %}
                <option value="{{ cls.id }}" {% if cls.id|stringformat:"s" == selected_class_id %}selected{% endif %}>
                    {{ cls }}
                </option>
            {% empty %}
                <option disabled>No classes available</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">Filter</button>
    </form>
    
    {% for student, subjects in student_results.items %}
        <div class="student-section mb-5">
            <h4><strong>{{ student }}</strong> </h4> <!-- Display the student ID here -->
            <table class="table table-striped projects">
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>BOT</th>
                        <th>MOT</th>
                        <th>EOT</th>
                        <th>Final Score</th>
                        <th>Grade</th>
                        <th>Points</th>
                    </tr>
                </thead>
                <tbody>
                    {% for subject, data in subjects.items %}
                        {% if subject != 'total_final_score' and subject != 'total_points' and subject != 'student_id' %}
                        <tr>
                            <td>{{ subject }}</td>
                            <td>{{ data.BOT }}</td>
                            <td>{{ data.MOT }}</td>
                            <td>{{ data.EOT }}</td>
                            <td>{{ data.final_score }}</td>
                            <td>{{ data.grade }}</td>
                            <td>{{ data.points }}</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                    <!-- Total row for Final Score and Points -->
                    <tr>
                        <td><strong>Total</strong></td>
                        <td></td> <!-- Empty cell for BOT -->
                        <td></td> <!-- Empty cell for MOT -->
                        <td></td> <!-- Empty cell for EOT -->
                        <td><strong>{{ subjects.total_final_score }}</strong></td>
                        <td></td> <!-- Empty cell for Grade -->
                        <td><strong>{{ subjects.total_points }}</strong></td>
                    </tr>
                </tbody>
            </table>
            <!-- Single "View Report Card" button -->
            <div class="text-right mt-2">
                <a href="{% url 'report_card' student_id=subjects.student_id %}" class="btn btn-primary">
                    View Report Card
                </a>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}
