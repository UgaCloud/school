{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Class Performance Summary</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .filters-card { background: #8B0000; color: #fff; border-radius: 8px; padding: 15px; }
        .summary-card { background: #fff; padding: 20px; border-radius: 8px; text-align: center; }
        .summary-card h4 { margin-bottom: 5px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
    </style>
</head>
<body class="p-3">

<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h4><i class="fas fa-chart-line"></i> Class Performance Summary</h4>
        <p class="text-muted mb-0">Academic Year: {{ selected_academic_year_name }} | Term: {{ selected_term_name }}</p>
    </div>
    <div>
        <a href="#" class="btn btn-secondary"><i class="fas fa-file-export"></i> Export</a>
        <a href="#" class="btn btn-primary"><i class="fas fa-print"></i> Print</a>
    </div>
</div>

<!-- Filters -->
<div class="filters-card mb-4">
    <form method="get" class="form-row align-items-end">
        <div class="col-md-3">
            <label>Academic Year</label>
            <select name="academic_year_id" class="form-control" onchange="this.form.submit()">
                <option value="">All</option>
                {% for year in academic_years %}
                <option value="{{ year.id }}" {% if selected_academic_year_id == year.id|stringformat:"s" %}selected{% endif %}>
                    {{ year.academic_year }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label>Term</label>
            <select name="term_id" class="form-control" onchange="this.form.submit()">
                <option value="">All</option>
                {% for t in terms %}
                <option value="{{ t.id }}" {% if selected_term_id == t.id|stringformat:"s" %}selected{% endif %}>
                    {{ t.term }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3 text-right mt-4">
            <a href="?reset=1" class="btn btn-light"><i class="fas fa-undo"></i> Reset</a>
        </div>
    </form>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="summary-card">
            <h4>{{ best_students|length }}</h4>
            <small>Best Students per Class</small>
        </div>
    </div>
    <div class="col-md-3">
        <div class="summary-card">
            
            <small>Best Subject</small>
        </div>
    </div>
    <div class="col-md-3">
        <div class="summary-card">
            <h4>{{ classes|length }}</h4>
            <small>Total Classes</small>
        </div>
    </div>
</div>

<!-- Best Students per Class -->
<div class="card mb-4">
    <div class="card-header"><strong>Best Performing Students per Class</strong></div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="thead-light">
                <tr>
                    <th>Photo</th>
                    <th>Class</th>
                    <th>Student</th>
                    <th>Average</th>
                    <th>Grade</th>
                    <th>Points</th>
                </tr>
            </thead>
            <tbody>
                {% for s in best_students %}
                <tr>
                    <td><img src="{{ s.photo_url }}" class="avatar"></td>
                    <td>{{ s.class_name }}</td>
                    <td>{{ s.student_name }}</td>
                    <td>{{ s.average }}</td>
                    <td>{{ s.grade }}</td>
                    <td>{{ s.points }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="6" class="text-center">No data</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Best Subject -->
{% if best_subject %}
<div class="card mb-4">
    <div class="card-header"><strong>Best Performing Subject</strong></div>
    <div class="card-body">
        <p><strong>{{ best_subject.subject }}</strong> - Average: {{ best_subject.average }} (Grade: {{ best_subject.grade }}, Points: {{ best_subject.points }})</p>
    </div>
</div>
{% endif %}

<!-- Best per Assessment -->
<div class="card">
    <div class="card-header"><strong>Best Performing Student per Assessment Type</strong></div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="thead-light">
                <tr>
                    <th>Assessment Type</th>
                    <th>Class</th>
                    <th>Student</th>
                    <th>Score</th>
                    <th>Grade</th>
                </tr>
            </thead>
            <tbody>
                {% for a in best_per_assessment %}
                <tr>
                    <td>{{ a.assessment_type }}</td>
                    <td>{{ a.class_name }}</td>
                    <td>{{ a.student_name }}</td>
                    <td>{{ a.score }}</td>
                    <td>{{ a.grade }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="5" class="text-center">No data</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
</body>
</html>
