{% extends "../base.html" %}

{% block page_title %}
<h1 class="text-3xl font-bold text-gray-800 mb-6">📅 School Timetable</h1>
{% endblock page_title %}

{% block content %}
<div class="container mx-auto p-8">
    <!-- Search and Filter Section -->
    <div class="flex justify-between mb-6">
        <input 
            type="text" 
            placeholder="Search timetable..." 
            class="border border-gray-300 rounded-lg px-4 py-2 w-1/3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        />
        <select class="border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="">Filter by Weekday</option>
            <option value="MON">Monday</option>
            <option value="TUE">Tuesday</option>
            <option value="WED">Wednesday</option>
            <option value="THU">Thursday</option>
            <option value="FRI">Friday</option>
            <option value="SAT">Saturday</option>
            <option value="SUN">Sunday</option>
        </select>
    </div>

    <!-- Timetable Table -->
    <div class="overflow-x-auto shadow-md sm:rounded-lg">
        <table class="min-w-full text-sm text-left text-gray-700 border border-gray-300">
            <thead>
                <tr>
                    <th scope="col" class="px-6 py-3 border-b border-gray-300 text-gray-900 bg-indigo-600">📘 Class Stream</th>
                    <th scope="col" class="px-6 py-3 border-b border-gray-300 text-gray-900 bg-indigo-600">📚 Subject</th>
                    <th scope="col" class="px-6 py-3 border-b border-gray-300 text-gray-900 bg-indigo-600">👨‍🏫 Teacher</th>
                    <th scope="col" class="px-6 py-3 border-b border-gray-300 text-gray-900 bg-indigo-600">📅 Day</th>
                    <th scope="col" class="px-6 py-3 border-b border-gray-300 text-gray-900 bg-indigo-600">⏰ Time Slot</th>
                    <th scope="col" class="px-6 py-3 border-b border-gray-300 text-gray-900 bg-indigo-600">🏫 Classroom</th>
                </tr>
                
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for timetable in timetables %}
                    <tr class="hover:bg-gray-100 transition duration-150">
                        <td class="px-6 py-4 font-semibold text-gray-900">{{ timetable.class_stream }}</td>
                        <td class="px-6 py-4 text-gray-800">{{ timetable.subject }}</td>
                        <td class="px-6 py-4 text-gray-800">{{ timetable.teacher }}</td>
                        <td class="px-6 py-4">
                            <span class="px-3 py-1 text-sm font-medium text-white rounded-full {{ timetable.weekday|lower }}-bg">
                                {{ timetable.weekday }}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-gray-800">{{ timetable.time_slot }}</td>
                        <td class="px-6 py-4 text-gray-800">{{ timetable.classroom }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            No timetable available.
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Tailwind CSS for Day colors -->
<style>
    .mon-bg { background-color: #4a90e2; }
    .tue-bg { background-color: #50e3c2; }
    .wed-bg { background-color: #f5a623; }
    .thu-bg { background-color: #d0021b; }
    .fri-bg { background-color: #7ed321; }
    .sat-bg { background-color: #b8e986; }
    .sun-bg { background-color: #bd10e0; }

    /* Additional Styling for Table Header */
    th {
        letter-spacing: 0.05em;
        border-bottom-width: 2px;
        text-transform: uppercase;
        font-weight: 600;
    }

    table th {
        font-size: 0.95rem;
    }

    table td {
        font-size: 0.875rem;
    }
</style>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.querySelector('input[type="text"][placeholder="Search timetable..."]');
    const weekdaySelect = document.querySelector('select');

    function filterTable() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedDay = weekdaySelect.value;

      const rows = document.querySelectorAll('tbody tr');

      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const classStream = cells[0].textContent.toLowerCase();
        const subject = cells[1].textContent.toLowerCase();
        const teacher = cells[2].textContent.toLowerCase();
        const day = cells[3].textContent.trim();

        // Check if any of the text fields contain the search term
        const matchesSearch = 
          classStream.includes(searchTerm) ||
          subject.includes(searchTerm) ||
          teacher.includes(searchTerm) ||
          day.toLowerCase().includes(searchTerm);

        // Check if the selected weekday matches (or if no filter selected)
        const matchesDay = !selectedDay || day.toUpperCase() === selectedDay;

        // Show row if both conditions are true
        if (matchesSearch && matchesDay) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // Attach event listeners
    searchInput.addEventListener('input', filterTable);
    weekdaySelect.addEventListener('change', filterTable);
  });
</script>

{% endblock %}
