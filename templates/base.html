<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {% if school_settings and school_settings.school_logo %}
    <link rel="icon" href="{{ school_settings.school_logo.url }}" type="image/x-icon" />
  {% else %}
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon" />
  {% endif %}
  <title>School MIS</title>

  <!-- Bootstrap -->
  <link href="{% static 'vendors/bootstrap/dist/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'css/custom_overrides.css' %}" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link href="{% static 'vendors/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">
  <!-- NProgress -->
  <link href="{% static 'vendors/nprogress/nprogress.css' %}" rel="stylesheet">
  <!-- iCheck -->
  <link href="{% static 'vendors/iCheck/skins/flat/green.css' %}" rel="stylesheet">
  <!-- Other CSS vendors -->
  <link href="{% static 'vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendors/jqvmap/dist/jqvmap.min.css' %}" rel="stylesheet" />
  <link href="{% static 'vendors/bootstrap-daterangepicker/daterangepicker.css' %}" rel="stylesheet">

  <!-- Datatables CSS -->
  <link href="{% static '/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static '/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static '/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static '/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static '/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css' %}" rel="stylesheet">

  <!-- Custom Theme Style -->
  <link href="{% static 'build/css/custom.min.css' %}" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css"
    rel="stylesheet" />

  <style>
    /* Unified Table Styling */
    .table {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(39, 41, 93, 0.1);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #ffffff;
    }

    .table th,
    .table td {
      border: 1px solid #e5e7eb;
      padding: 0.75rem;
      text-align: left;
      vertical-align: middle;
    }

    .table th {
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      text-align: center;
    }

    .table tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    .table tbody tr:hover {
      background: #eff6ff;
      transition: background 0.2s ease;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
      border-radius: 4px;
      margin: 0 2px;
      padding: 0.25rem 0.5rem;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      color: #2c3e50;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      background: #2c3e50;
      color: #ffffff;
      border: 1px solid #2c3e50;
    }

    .dataTables_wrapper .dataTables_filter input {
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 0.5rem;
      font-size: 0.875rem;
    }

    .dataTables_wrapper .dataTables_length select {
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 0.25rem;
      font-size: 0.875rem;
    }

    .dt-buttons .btn {
      border-radius: 4px;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      margin-right: 0.5rem;
    }

    @media print {
      .table {
        box-shadow: none;
        border: 1px solid #d1d5db;
      }

      .table tbody tr:hover {
        background: inherit;
      }

      .dataTables_wrapper .dataTables_paginate,
      .dataTables_wrapper .dataTables_filter,
      .dataTables_wrapper .dataTables_length,
      .dt-buttons {
        display: none;
      }
    }

    @media screen and (max-width: 768px) {
      .table {
        font-size: 0.75rem;
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .table th,
      .table td {
        padding: 0.5rem;
        min-width: 100px;
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 0.2rem 0.4rem;
        font-size: 0.65rem;
      }

      .dataTables_wrapper .dataTables_filter input,
      .dataTables_wrapper .dataTables_length select {
        font-size: 0.75rem;
      }
    }

    /* Modal Styles */
    .role-card {
      transition: all .2s ease;
      cursor: pointer;
      background: #fff;
    }

    .role-card.hover-elevate:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 14px rgba(0, 0, 0, .08);
    }

    .role-card.selected {
      border-color: #28a745;
      box-shadow: 0 0 0 2px rgba(40, 167, 69, .15);
    }

    .role-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: #f0f2f5;
      color: #2c3e50;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-header.bg-dark {
      background: #2c3e50 !important;
    }
  </style>

</head>

<body class="nav-md">
  <div class="container body">
    <div class="main_container">

      {% include 'includes/sidebar.html' %}

      {% include 'includes/top_nav.html' %}

      <!-- page content -->
      <div class="right_col" role="main">
        <div class="">
          <div class="page-title">
            <div class="title_left">
              <h3>
                {% block page_title %}
                {% endblock page_title %}
              </h3>
            </div>

            <div class="title_right">
              <div class="col-md-5 col-sm-5   form-group pull-right top_search">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search for...">
                  <span class="input-group-btn">
                    <button class="btn btn-secondary" type="button">Go!</button>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        {% include 'includes/messages.html' %}

        <!-- Content Block -->
        {% block content %}{% endblock content %}

        {% include 'includes/footer.html' %}

      </div>
    </div>
  </div>

  {% include 'includes/scripts.html' %}

  {% if request.user.is_authenticated %}
  <!-- Switch Role Modal -->
  <div class="modal fade" id="switchRoleModal" tabindex="-1" role="dialog" aria-labelledby="switchRoleLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md" role="document">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header bg-dark text-white">
          <h5 class="modal-title d-flex align-items-center" id="switchRoleLabel">
            <i class="fa fa-user-shield mr-2"></i> Switch Role
          </h5>
          <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <form method="post" action="{% url 'switch_role' %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <small class="text-muted d-block">Current role</small>
              <div class="h5 mb-0">
                {{ active_role|default:user.staff_account.role.name }}
              </div>
            </div>

            <div class="mb-2">
              <small class="text-muted">Select a role to activate</small>
            </div>

            <div class="container-fluid px-0">
              <div class="row">
                {% for role in user.staff_account.staff.roles.all %}
                <div class="col-12 mb-2">
                  <label class="w-100 m-0">
                    <input type="radio" name="role" class="d-none role-radio" value="{{ role.id }}" {% if active_role == role.name %}checked{% endif %}>
                    <div
                      class="role-card d-flex align-items-center justify-content-between p-3 border rounded hover-elevate {% if active_role == role.name %}selected{% endif %}">
                      <div class="d-flex align-items-center">
                        <div class="role-icon mr-3">
                          <i class="fa fa-id-badge"></i>
                        </div>
                        <div class="role-info">
                          <div class="font-weight-bold">{{ role.name }}</div>
                          <small class="text-muted">Click to select</small>
                        </div>
                      </div>
                      <div>
                        <span
                          class="badge badge-pill {% if active_role == role.name %}badge-success{% else %}badge-secondary{% endif %}">
                          {% if active_role == role.name %}Active{% else %}Available{% endif %}
                        </span>
                      </div>
                    </div>
                  </label>
                </div>
                {% empty %}
                <div class="col-12">
                  <div class="alert alert-warning mb-0">
                    No roles assigned to your account. Please contact an administrator.
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>

          <div class="modal-footer bg-light">
            <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-dark">
              <i class="fa fa-sync mr-1"></i> Apply Role
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  {% endif %}

</body>

</html>