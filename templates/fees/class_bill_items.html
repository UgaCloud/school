{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load humanize %}

{% block page_title %}{{ academic_class.Class.name}} - CLASS BILLS{% endblock page_title %}
{% block content %}
    <div class="row">
        <div class="col-md-12">
            <div class="x_panel">
                <div class="x_content">  

                    <!-- Search Filters -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <input type="text" id="searchYear" class="form-control" placeholder="Search by Academic Year">
                        </div>
                        <div class="col-md-4">
                            <input type="text" id="searchTerm" class="form-control" placeholder="Search by Term">
                        </div>
                        
                    </div>

                    <!-- Table -->
                    <table id="datatable-checkbox" class="table table-striped table-bordered bulk_action">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Item Name</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Academic Year</th>  
                                <th>Term</th>  
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="billTableBody">
                            {% for item in class_bill_items %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ item.bill_item }}</td>
                                <td>{{ item.description }}</td>
                                <td>{{ item.amount }}</td>
                                <td class="year-column">{{ academic_class.academic_year }}</td> 
                                <td class="term-column">{{ academic_class.term }}</td> 
                                <td>
                                    <a href="{% url 'edit_class_bill_item' item.id %}" class="btn btn-primary btn-xs">
                                        <i class="fa fa-edit"></i>
                                    </a>
                                    <a href="{% url 'delete_class_bill_item' item.id %}" 
                                       class="btn btn-danger btn-xs" 
                                       onclick="return confirm('Are you sure you want to delete this bill item?');">
                                        <i class="fa fa-trash-o"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <!-- No Results Message -->
                    <p id="noResultsMessage" class="text-center text-danger" style="display: none;">
                        No results found for the given Academic Year and Term.
                    </p>

                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for Filtering -->
    <script>
        document.getElementById("searchYear").addEventListener("keyup", filterTable);
        document.getElementById("searchTerm").addEventListener("keyup", filterTable);

        function filterTable() {
            let yearFilter = document.getElementById("searchYear").value.toLowerCase();
            let termFilter = document.getElementById("searchTerm").value.toLowerCase();
            let rows = document.querySelectorAll("#billTableBody tr");
            let noResultsMessage = document.getElementById("noResultsMessage");
            let visibleRows = 0;

            rows.forEach(row => {
                let year = row.querySelector(".year-column").textContent.toLowerCase();
                let term = row.querySelector(".term-column").textContent.toLowerCase();

                if (year.includes(yearFilter) && term.includes(termFilter)) {
                    row.style.display = "";
                    visibleRows++;
                } else {
                    row.style.display = "none";
                }
            });

            // Show "No Results" message if nothing matches
            noResultsMessage.style.display = visibleRows === 0 ? "block" : "none";
        }

        function resetFilters() {
            document.getElementById("searchYear").value = "";
            document.getElementById("searchTerm").value = "";
            filterTable();
        }
    </script>

{% endblock content %}
