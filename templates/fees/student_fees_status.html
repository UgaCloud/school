{% extends "base.html" %}
{% load humanize %}
{% block page_title %}<h3 class="text-primary">Student Fees Payment Status</h3>{% endblock page_title %}
{% block content %}
<div class="container-fluid">
    
    <!-- Table Section -->
    <div class="table-responsive">
        <table id="datatable-checkbox" class="table table-hover table-bordered table-striped shadow-sm rounded">
            <thead class="thead-light">
                <tr>
                    <th colspan="2">Term: {{ term }}</th>
                    <th colspan="2">Academic Year: {{ academic_year }}</th>
                    <th colspan="5"></th> <!-- Empty cells to align the table properly -->
                </tr>
                <tr>
                    <th>Class</th>
                    <th>Student</th>
                    <th>Total Fees</th>
                    <th>Amount Paid</th>
                    <th>Balance</th>
                    <th>Payment Status</th>
                    <th>Action</th>  
                </tr>
            </thead>
            <tbody>
                {% for student_fee in student_fees_data %}
                <tr>
                    <td>{{ student_fee.academic_class }}</td>  
                    <td>{{ student_fee.student.student_name }}</td>
                    <td>{{ student_fee.total_amount|intcomma }}</td>
                    <td>{{ student_fee.amount_paid|intcomma }}</td>
                    <td>
                        {% if student_fee.balance == "0" %}
                            <span class="text-success" style="font-size: 1.1rem;">{{ student_fee.balance }}</span>
                        {% elif student_fee.balance|slice:":2" == "CR" %}
                            <span class="text-success" style="font-size: 1.1rem;">{{ student_fee.balance }}</span>
                        {% elif student_fee.balance|slice:":2" == "DR" %}
                            <span class="text-danger" style="font-size: 1.1rem;">{{ student_fee.balance }}</span>
                        {% else %}
                            <span style="font-size: 1.1rem;">{{ student_fee.balance }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if student_fee.balance == "0" %}
                            <span class="text-success" style="font-size: 1.1rem;">Cleared</span>
                        {% elif student_fee.payment_status == "Cleared" or "CR" in student_fee.balance %}
                            <span class="text-success" style="font-size: 1.1rem;">Cleared</span>
                        {% elif student_fee.payment_status == "Defaulter" %}
                            <span class="text-danger" style="font-size: 1.1rem;">Defaulter</span>
                        {% else %}
                            <span class="text-warning" style="font-size: 1.1rem;">{{ student_fee.payment_status }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if student_fee.bill_id %}
                            <a href="{% url 'student_bill_details_page' student_fee.bill_id %}" class="btn btn-info btn-sm">
                                <i class="fas fa-eye"></i> 
                            </a>
                        {% else %}
                            <span class="text-muted">No Bill</span>  
                        {% endif %}
                    </td>
                    
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center text-muted">No students found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<script>
    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip(); // 
    });
</script>
{% endblock %}
